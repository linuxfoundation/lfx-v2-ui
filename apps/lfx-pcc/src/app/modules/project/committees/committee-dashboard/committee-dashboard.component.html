<!-- Copyright The Linux Foundation and each contributor to LFX. -->
<!-- SPDX-License-Identifier: MIT -->

<div class="container mx-auto py-6 px-8">
  @if (committeesLoading()) {
    <div class="flex justify-center items-center min-h-96 col-span-4">
      <div class="text-center">
        <i class="fa-light fa-spinner-third fa-spin text-3xl text-blue-600 mb-4"></i>
        <p class="text-gray-600">Loading committee details...</p>
      </div>
    </div>
  }

  @if (committees() && !committeesLoading()) {
    <div class="flex flex-col gap-6">
      <div class="flex items-center justify-between p-4 border-b border-gray-100">
        <div>
          <h2 class="text-[16px] font-bold text-gray-900">Committee Management</h2>
          <p class="text-[12px] font-normal text-gray-500 mt-1">
            Manage committees, their settings, and organizational structure. Sub-committees are indicated with indentation.
          </p>
        </div>
        <lfx-button
          label="New Committee"
          icon="fa-light fa-plus"
          severity="primary"
          (onClick)="openCreateDialog()"
          size="small"
          data-testid="committee-new-cta">
        </lfx-button>
      </div>

      <!-- Statistics Cards -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-3 w-full">
        <lfx-card styleClass="h-full" data-testid="stats-total-committees">
          <div class="p-3">
            <div class="text-[10px] text-gray-500 font-normal mb-1">Total Committees</div>
            <div class="flex items-center gap-2">
              <span class="text-[24px] text-gray-900 font-normal">{{ totalCommittees() }}</span>
              <div class="flex items-center gap-1 text-emerald-600">
                <i class="fa-light fa-trending-up text-[8px]"></i>
                <span class="text-[10px] font-medium">+2 this week</span>
              </div>
            </div>
          </div>
        </lfx-card>

        <lfx-card styleClass="h-full" data-testid="stats-public-committees">
          <div class="p-3">
            <div class="text-[10px] text-gray-500 font-normal mb-1">Public Committees</div>
            <div class="flex items-center gap-2">
              <span class="text-[24px] text-gray-900 font-normal">{{ publicCommittees() }}</span>
              <div class="inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-blue-100 text-blue-600 border border-blue-200">
                <span class="text-[9px] font-medium"
                  >{{ totalCommittees() > 0 ? ((publicCommittees() / totalCommittees()) * 100 | number: '1.0-0') : 0 }}% of total</span
                >
              </div>
            </div>
          </div>
        </lfx-card>

        <lfx-card styleClass="h-full" data-testid="stats-active-voting">
          <div class="p-3">
            <div class="text-[10px] text-gray-500 font-normal mb-1">Active Voting</div>
            <div class="flex items-center gap-2">
              <span class="text-[24px] text-gray-900 font-normal">{{ activeVoting() }}</span>
              <div class="inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-green-100 text-green-600 border border-green-200">
                <span class="text-[9px] font-medium">Voting enabled</span>
              </div>
            </div>
          </div>
        </lfx-card>

        <lfx-card styleClass="h-full" data-testid="stats-upcoming-meeting">
          <div class="p-3">
            <div class="text-[10px] text-gray-500 font-normal mb-1">Upcoming Meeting</div>
            <lfx-upcoming-committee-meeting></lfx-upcoming-committee-meeting>
          </div>
        </lfx-card>
      </div>

      <!-- Committee Management Section -->
      <lfx-card styleClass="h-full" class="h-full">
        <!-- Search and Filter Controls -->
        <div class="flex flex-col sm:flex-row gap-4 mb-6 p-4">
          <!-- Search Input -->
          <div class="flex-1">
            <lfx-input-text
              [form]="searchForm"
              control="search"
              placeholder="Search committees..."
              icon="fa-light fa-search"
              styleClass="w-full"
              size="small"
              data-testid="committee-search-input"></lfx-input-text>
          </div>

          <!-- Committee Type Filter Dropdown -->
          <div class="w-full sm:w-64">
            <lfx-select
              [form]="searchForm"
              control="category"
              size="small"
              [options]="categories()"
              placeholder="Select Committee Type"
              [showClear]="true"
              styleClass="w-full"
              (onChange)="onCategoryChange($event.value)"
              data-testid="committee-type-filter"></lfx-select>
          </div>

          <!-- Voting Status Filter Dropdown -->
          <div class="w-full sm:w-64">
            <lfx-select
              [form]="searchForm"
              control="votingStatus"
              size="small"
              [options]="votingStatusOptions()"
              placeholder="Select Voting Status"
              [showClear]="true"
              styleClass="w-full"
              (onChange)="onVotingStatusChange($event.value)"
              data-testid="committee-voting-status-filter"></lfx-select>
          </div>
        </div>

        @if (committees().length > 0) {
          <!-- Committee Table -->
          <div class="px-4 pb-4">
            <lfx-committee-table
              [committees]="filteredCommittees()"
              (editCommittee)="onEditCommittee($event)"
              (deleteCommittee)="onDeleteCommittee($event)"
              (viewCommittee)="onViewCommittee($event)"
              data-testid="committee-dashboard-table">
            </lfx-committee-table>
          </div>

          <!-- Confirmation dialog -->
          <p-confirmDialog></p-confirmDialog>
        } @else {
          <div class="flex justify-center items-center h-full p-4">
            <div class="text-center py-8">
              <i class="fa-light fa-people-group text-4xl text-gray-400 mb-4"></i>
              <h3 class="text-lg font-medium text-gray-900 mb-2">No Committees Yet</h3>
              <p class="text-gray-600 mb-4">This project doesn't have any committees yet.</p>
              <lfx-button
                label="Add First Committee"
                icon="fa-light fa-people-group"
                severity="secondary"
                (onClick)="openCreateDialog()"
                data-testid="committee-add-first"></lfx-button>
            </div>
          </div>
        }
      </lfx-card>
    </div>
  }
</div>
