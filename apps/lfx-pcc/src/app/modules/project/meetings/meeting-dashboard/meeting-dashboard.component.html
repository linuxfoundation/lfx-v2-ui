<!-- Copyright The Linux Foundation and each contributor to LFX. -->
<!-- SPDX-License-Identifier: MIT -->

<div class="container mx-auto py-6 px-8">
  @if (meetingsLoading()) {
    <div class="flex justify-center items-center min-h-96 col-span-4">
      <div class="text-center">
        <i class="fa-light fa-spinner-third fa-spin text-3xl text-blue-600 mb-4"></i>
        <p class="text-gray-600">Loading meeting details...</p>
      </div>
    </div>
  }

  @if ((meetings() || pastMeetings()) && !meetingsLoading() && !pastMeetingsLoading()) {
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 items-stretch">
      <div class="lg:col-span-3 items-stretch h-full">
        <div class="flex flex-col gap-6">
          <lfx-card [header]="meetingListView() === 'upcoming' ? 'Upcoming Meetings' : 'Past Meetings'">
            <!-- Search and Filter Controls -->
            <div class="flex flex-col items-center sm:flex-row gap-4 mb-6">
              <!-- Search Input -->
              <div class="flex-1">
                <lfx-input-text
                  [form]="searchForm"
                  control="search"
                  placeholder="Search meetings..."
                  icon="fa-light fa-search"
                  styleClass="w-full"
                  size="small"></lfx-input-text>
              </div>

              <!-- Visibility Filter Dropdown -->
              <div class="w-full sm:w-48">
                <lfx-select
                  [form]="searchForm"
                  control="visibility"
                  size="small"
                  [options]="visibilityOptions()"
                  placeholder="Select Visibility"
                  [showClear]="true"
                  styleClass="w-full"
                  (onChange)="onVisibilityChange($event.value)"></lfx-select>
              </div>

              <!-- Committee Filter Dropdown -->
              <div class="w-full sm:w-48">
                <lfx-select
                  [form]="searchForm"
                  control="committee"
                  size="small"
                  [options]="committeeOptions()"
                  placeholder="Select Committee"
                  [showClear]="true"
                  styleClass="w-full"
                  (onChange)="onCommitteeChange($event.value)"></lfx-select>
              </div>

              <!-- View Switcher -->
              <lfx-select-button
                size="small"
                [form]="viewForm"
                control="view"
                [options]="viewOptions"
                [unselectable]="false"
                [required]="true"
                (onChange)="onViewChange($event.value)"></lfx-select-button>
            </div>
          </lfx-card>
          @if (filteredMeetings().length > 0) {
            <!-- List View -->
            @if (currentView() === 'list') {
              <!-- Meetings Card Grid -->
              <div class="grid grid-cols-1 gap-4">
                @for (meeting of filteredMeetings(); track meeting.uid) {
                  <lfx-meeting-card
                    [meetingInput]="meeting"
                    (meetingUpdated)="refreshMeetings()"
                    (meetingDeleted)="refreshMeetings()"
                    [pastMeeting]="meetingListView() === 'past'"
                    [showBorder]="true"
                    pAnimateOnScroll
                    class="animate-delay-2000"
                    enterClass="animate-enter fade-in-10 slide-in-from-b-8 animate-duration-1000"
                    leaveClass="animate-leave fade-out-0"></lfx-meeting-card>
                }
              </div>
            }

            <!-- Calendar View -->
            @if (currentView() === 'calendar') {
              <div class="bg-white rounded-lg p-6">
                <lfx-fullcalendar
                  [events]="calendarEvents()"
                  [height]="600"
                  (eventClick)="onCalendarEventClick($event)"
                  pAnimateOnScroll
                  class="animate-delay-2000"
                  enterClass="animate-enter fade-in-10 slide-in-from-b-8 animate-duration-1000"
                  leaveClass="animate-leave fade-out-0"></lfx-fullcalendar>
              </div>
            }

            <!-- Empty filtered results message -->
            @if (filteredMeetings().length === 0 && meetings().length > 0) {
              <div class="flex justify-center items-center h-64">
                <div class="text-center">
                  <i class="fa-light fa-calendar-xmark text-4xl text-gray-400 mb-4"></i>
                  <p class="text-gray-600">No meetings found</p>
                  <p class="text-sm text-gray-500">Try adjusting your search or filters</p>
                </div>
              </div>
            }

            <!-- Confirmation dialog -->
            <p-confirmDialog></p-confirmDialog>
          } @else {
            <div class="flex justify-center items-center h-full">
              <div class="text-center py-8">
                <i class="fa-light fa-calendar text-4xl text-gray-400 mb-4"></i>
                <h3 class="text-lg font-medium text-gray-900 mb-2">No Meetings Yet</h3>
                <p class="text-gray-600 mb-4">This project doesn't have any meetings yet.</p>
                <lfx-button
                  label="Schedule First Meeting"
                  icon="fa-light fa-calendar-plus"
                  severity="secondary"
                  routerLink="/project/{{ project()?.slug }}/meetings/create"></lfx-button>
              </div>
            </div>
          }
        </div>
      </div>
      <div class="lg:col-span-1 flex flex-col">
        <div class="sticky top-24">
          <lfx-card header="Quick Actions">
            <lfx-menu [model]="menuItems" styleClass="border-none"></lfx-menu>
          </lfx-card>

          <div class="flex flex-col gap-4 mt-6">
            <lfx-card header="Meeting Statistics" styleClass="h-full" class="h-full">
              <div class="flex flex-col gap-3">
                <div class="flex justify-between items-center">
                  <span class="text-sm font-sans text-gray-600">Total Meetings</span>
                  <span class="text-base font-display font-semibold text-gray-900">{{ meetings().length }}</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm font-sans text-gray-600">Public</span>
                  <span class="text-base font-display font-semibold text-gray-900">{{ publicMeetingsCount() }}</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm font-sans text-gray-600">Private</span>
                  <span class="text-base font-display font-semibold text-gray-900">{{ privateMeetingsCount() }}</span>
                </div>
              </div>
            </lfx-card>
          </div>
        </div>
      </div>
    </div>
  }
</div>
