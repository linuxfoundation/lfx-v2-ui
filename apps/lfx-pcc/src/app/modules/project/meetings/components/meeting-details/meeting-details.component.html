<!-- Copyright The Linux Foundation and each contributor to LFX. -->
<!-- SPDX-License-Identifier: MIT -->

<div class="space-y-6">
  <!-- Basic Information Section -->
  <div class="flex flex-col gap-4">
    <!-- Meeting Title (Required) -->
    <div>
      <label for="meeting-title" class="block text-sm font-medium text-gray-700 mb-1"> Meeting Title <span class="text-red-500">*</span> </label>
      <lfx-input-text
        size="small"
        [form]="form()"
        control="title"
        id="meeting-title"
        placeholder="Enter meeting title"
        styleClass="w-full"
        data-testid="meeting-details-title-input"></lfx-input-text>
      @if (titleWasAutoGenerated()) {
        <p class="mt-1 text-xs text-gray-500">This title was auto-generated based on your meeting type and date. You can customize it.</p>
      }
      @if (form().get('title')?.errors?.['required'] && form().get('title')?.touched) {
        <p class="mt-1 text-sm text-red-600">Meeting title is required</p>
      }
    </div>

    <!-- Agenda (Required) -->
    <div>
      <div class="flex items-center justify-between mb-2">
        <label for="meeting-agenda" class="block text-sm font-medium text-gray-700"> Agenda <span class="text-red-500">*</span> </label>
        @if (!showAiHelper() && !showTemplateSelector()) {
          <div class="flex items-center gap-2">
            <lfx-button
              (onClick)="showAgendaTemplateSelector()"
              icon="fa-light fa-book-open"
              label="Use Template"
              size="small"
              [text]="true"
              styleClass="text-gray-600 hover:text-gray-700 hover:bg-gray-50 text-xs h-7"
              data-testid="meeting-details-template-button"></lfx-button>
            <lfx-button
              (onClick)="showAiAgendaHelper()"
              icon="fa-light fa-sparkles"
              label="Help me write this"
              size="small"
              [text]="true"
              styleClass="text-blue-600 hover:text-blue-700 hover:bg-blue-50 text-xs h-7"
              data-testid="meeting-details-ai-helper-button"></lfx-button>
          </div>
        }
      </div>

      @if (showAiHelper()) {
        <div class="mb-4 p-4 bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg">
          <div class="flex items-start gap-3 mb-3">
            <div class="bg-gradient-to-r flex items-center justify-center from-blue-500 to-purple-600 p-1.5 rounded-full">
              <i class="fa-light fa-sparkles text-white text-sm"></i>
            </div>
            <div>
              <h4 class="text-sm font-semibold text-gray-900 mb-1">AI Agenda Generator</h4>
              <p class="text-sm text-gray-600">Tell me what you want to accomplish in this meeting, and I'll create a structured agenda for you.</p>
            </div>
          </div>

          <div class="space-y-3">
            <lfx-textarea
              [form]="form()"
              control="aiPrompt"
              placeholder="Example: 'Discuss the new authentication system implementation, review security concerns, and plan the rollout timeline for our open source project'"
              [rows]="3"
              styleClass="w-full text-sm border-gray-200 focus:border-blue-500 focus:ring-blue-500 bg-white"
              data-testid="meeting-details-ai-prompt"></lfx-textarea>

            <div class="flex items-center gap-2">
              <lfx-button
                (onClick)="generateAiAgenda()"
                [disabled]="!form().get('aiPrompt')?.value?.trim() || isGeneratingAgenda()"
                [loading]="isGeneratingAgenda()"
                icon="fa-light fa-sparkles"
                label="Generate Agenda"
                size="small"
                styleClass="bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white text-sm h-8"
                data-testid="meeting-details-generate-agenda"></lfx-button>

              <lfx-button
                (onClick)="hideAiAgendaHelper()"
                label="Cancel"
                size="small"
                [text]="true"
                styleClass="text-gray-500 hover:text-gray-700 text-sm h-8"
                data-testid="meeting-details-cancel-ai"></lfx-button>
            </div>
          </div>
        </div>
      }

      @if (showTemplateSelector()) {
        <lfx-agenda-template-selector
          [meetingType]="form().get('meeting_type')?.value"
          [visible]="showTemplateSelector()"
          (templateSelected)="applyTemplate($event)"
          (closeSelector)="hideAgendaTemplateSelector()"
          data-testid="meeting-details-template-selector">
        </lfx-agenda-template-selector>
      }

      <lfx-textarea
        [form]="form()"
        control="description"
        id="meeting-agenda"
        placeholder="Enter meeting agenda and key discussion points"
        styleClass="w-full min-h-32"
        data-testid="meeting-details-agenda-textarea"></lfx-textarea>
      <p class="mt-1 text-xs text-gray-500">A clear agenda helps participants prepare and keeps discussions focused</p>
      @if (form().get('description')?.errors?.['required'] && form().get('description')?.touched) {
        <p class="mt-1 text-sm text-red-600">Meeting agenda is required</p>
      }
    </div>
  </div>

  <!-- Date & Time Section -->
  <div class="flex flex-col gap-4">
    <h3 class="text-base font-medium text-gray-900">Date & Time</h3>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <!-- Start Date -->
      <div>
        <label for="start-date" class="block text-sm font-medium text-gray-700 mb-1"> Start Date <span class="text-red-500">*</span> </label>
        <lfx-calendar
          [form]="form()"
          control="startDate"
          id="start-date"
          placeholder="Select date"
          [showIcon]="true"
          [minDate]="minDate()"
          styleClass="w-full"
          data-testid="meeting-details-start-date"></lfx-calendar>
        @if (form().get('startDate')?.errors?.['required'] && form().get('startDate')?.touched) {
          <p class="mt-1 text-sm text-red-600">Start date is required</p>
        }
      </div>

      <!-- Start Time -->
      <div>
        <label for="start-time" class="block text-sm font-medium text-gray-700 mb-1"> Start Time <span class="text-red-500">*</span> </label>
        <lfx-time-picker
          [form]="form()"
          control="startTime"
          id="start-time"
          placeholder="Select time"
          styleClass="w-full"
          width="w-48"
          data-testid="meeting-details-start-time"></lfx-time-picker>
        @if (form().get('startTime')?.errors?.['required'] && form().get('startTime')?.touched) {
          <p class="mt-1 text-sm text-red-600">Start time is required</p>
        }
      </div>

      <!-- Duration -->
      <div>
        <label for="duration" class="block text-sm font-medium text-gray-700 mb-1"> Duration <span class="text-red-500">*</span> </label>
        <lfx-select
          size="small"
          [form]="form()"
          control="duration"
          [options]="durationOptions"
          placeholder="Select duration"
          styleClass="w-full"
          id="duration"
          data-testid="meeting-details-duration-select"></lfx-select>
        @if (form().get('duration')?.errors?.['required'] && form().get('duration')?.touched) {
          <p class="mt-1 text-sm text-red-600">Duration is required</p>
        }
      </div>
    </div>

    <!-- Future Date/Time validation error -->
    @if (form().errors?.['futureDateTime'] && (form().get('startDate')?.touched || form().get('startTime')?.touched)) {
      <p class="mt-1 text-sm text-red-600">Meeting must be scheduled in the future</p>
    }

    <!-- Custom Duration (shown when 'custom' is selected) -->
    @if (form().get('duration')?.value === 'custom') {
      <div>
        <label for="custom-duration" class="block text-sm font-medium text-gray-700 mb-1">
          Custom Duration (minutes) <span class="text-red-500">*</span>
        </label>
        <lfx-input-text
          size="small"
          [form]="form()"
          control="customDuration"
          id="custom-duration"
          placeholder="Enter minutes (5-480)"
          type="number"
          styleClass="w-full"
          data-testid="meeting-details-custom-duration"></lfx-input-text>
        @if (form().get('customDuration')?.errors?.['required'] && form().get('customDuration')?.touched) {
          <p class="mt-1 text-sm text-red-600">Custom duration is required</p>
        }
        @if (form().get('customDuration')?.errors?.['min'] && form().get('customDuration')?.touched) {
          <p class="mt-1 text-sm text-red-600">Custom duration must be at least 5 minutes</p>
        }
        @if (form().get('customDuration')?.errors?.['max'] && form().get('customDuration')?.touched) {
          <p class="mt-1 text-sm text-red-600">Custom duration cannot exceed 480 minutes (8 hours)</p>
        }
      </div>
    }

    <!-- Timezone -->
    <div>
      <label for="timezone" class="block text-sm font-medium text-gray-700 mb-1"> Timezone <span class="text-red-500">*</span> </label>
      <lfx-select
        size="small"
        [filter]="true"
        [form]="form()"
        control="timezone"
        [options]="timezoneOptions"
        placeholder="Select timezone"
        styleClass="w-full"
        id="timezone"
        data-testid="meeting-details-timezone-select"></lfx-select>
      @if (form().get('timezone')?.errors?.['required'] && form().get('timezone')?.touched) {
        <p class="mt-1 text-sm text-red-600">Timezone is required</p>
      }
    </div>

    <!-- Recurring Meeting Toggle -->
    <div class="bg-gray-50 border border-gray-200 p-4 rounded-lg">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <i class="fa-light fa-repeat text-gray-500"></i>
          <div>
            <label for="recurring-toggle" class="text-sm font-medium text-gray-900">Recurring Meeting</label>
            <p class="text-xs text-gray-500">This meeting repeats on a schedule</p>
          </div>
        </div>
        <lfx-toggle [form]="form()" control="isRecurring" id="recurring-toggle" data-testid="meeting-details-recurring-toggle"></lfx-toggle>
      </div>
    </div>

    @if (form().get('isRecurring')?.value) {
      <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg">
        <div class="flex items-start gap-3">
          <div class="bg-primary flex items-center justify-center px-1 py-1 rounded-full">
            <i class="fa-light fa-info-circle text-white text-sm"></i>
          </div>
          <div>
            <p class="text-sm text-gray-700">
              Recurring meetings are great for regular touchpoints like weekly standups, monthly reviews, or quarterly planning sessions.
            </p>
          </div>
        </div>
      </div>
    }

    <!-- Recurrence Options (only show when isRecurring is true) -->
    @if (form().get('isRecurring')?.value) {
      <div>
        <div class="flex items-center gap-2 mb-1">
          <label for="recurrence" class="block text-sm font-medium text-gray-700">Repeat</label>
          <i
            class="fa-light fa-info-circle text-gray-400 cursor-help"
            pTooltip="Set up recurring meetings that repeat daily, weekly, monthly, or on weekdays"
            tooltipPosition="right"
            tooltipStyleClass="text-xs max-w-xs"></i>
        </div>
        <lfx-select
          size="small"
          [form]="form()"
          control="recurrence"
          [options]="recurrenceOptions()"
          placeholder="Select recurrence"
          styleClass="w-full"
          id="recurrence"
          data-testid="meeting-details-recurrence-select"></lfx-select>
      </div>
    }

    <!-- Early Join Time -->
    <div>
      <div class="flex items-center gap-2 mb-1">
        <label for="early-join-time" class="block text-sm font-medium text-gray-700"> Early Join Time (minutes before start) </label>
        <i
          class="fa-light fa-info-circle text-gray-400 cursor-help"
          pTooltip="Allow participants to join the meeting early. Useful for informal networking before the official start time"
          tooltipPosition="right"
          tooltipStyleClass="text-xs max-w-xs"></i>
      </div>
      <lfx-input-text
        size="small"
        [form]="form()"
        control="early_join_time_minutes"
        id="early-join-time"
        placeholder="10-60 minutes"
        type="number"
        styleClass="w-full"
        data-testid="meeting-details-early-join"></lfx-input-text>
      @if (form().get('early_join_time_minutes')?.errors?.['min'] && form().get('early_join_time_minutes')?.touched) {
        <p class="mt-1 text-sm text-red-600">Early join time must be at least 10 minutes</p>
      }
      @if (form().get('early_join_time_minutes')?.errors?.['max'] && form().get('early_join_time_minutes')?.touched) {
        <p class="mt-1 text-sm text-red-600">Early join time cannot exceed 60 minutes</p>
      }
    </div>
  </div>
</div>
