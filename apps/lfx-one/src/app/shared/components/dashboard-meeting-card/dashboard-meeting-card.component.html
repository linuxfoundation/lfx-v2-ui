<!-- Copyright The Linux Foundation and each contributor to LFX. -->
<!-- SPDX-License-Identifier: MIT -->

<!-- Card wrapper with border and shadow -->
<div class="bg-white rounded-xl border border-gray-200 shadow-sm hover:shadow-md transition-shadow" data-testid="dashboard-meeting-card">
  <div class="p-4 space-y-3">
    <!-- Header with meeting type and feature icons -->
    <div class="flex items-start justify-between gap-2">
      <div class="flex items-center gap-2 flex-wrap">
        <span [class]="meetingTypeInfo().className + ' text-xs px-2 py-1 font-medium rounded'" data-testid="dashboard-meeting-card-type-badge">
          {{ meetingTypeInfo().label }}
        </span>
        @if (meeting().project_name) {
          <span class="border border-gray-300 bg-white text-gray-700 text-xs px-2 py-1 font-medium rounded" data-testid="dashboard-meeting-card-project-badge">
            {{ meeting().project_name }}
          </span>
        }
      </div>
      <div class="flex items-center gap-1">
        @if (hasYoutubeUploads()) {
          <div
            class="w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center"
            pTooltip="YouTube Auto-Upload Enabled"
            tooltipPosition="top"
            data-testid="dashboard-meeting-card-youtube-icon">
            <i class="fa-light fa-upload text-xs text-gray-800"></i>
          </div>
        }
        @if (hasRecording()) {
          <div
            class="w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center"
            pTooltip="Recording Enabled"
            tooltipPosition="top"
            data-testid="dashboard-meeting-card-recording-icon">
            <i class="fa-light fa-video text-xs text-gray-800"></i>
          </div>
        }
        @if (hasTranscripts()) {
          <div
            class="w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center"
            pTooltip="Transcripts Enabled"
            tooltipPosition="top"
            data-testid="dashboard-meeting-card-transcript-icon">
            <i class="fa-light fa-file-lines text-xs text-gray-800"></i>
          </div>
        }
        @if (hasAiSummary()) {
          <div
            class="w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center"
            pTooltip="AI Summary Enabled"
            tooltipPosition="top"
            data-testid="dashboard-meeting-card-ai-icon">
            <i class="fa-light fa-sparkles text-xs text-gray-800"></i>
          </div>
        }
        @if (!isPrivate()) {
          <div
            class="w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center"
            pTooltip="Public Meeting"
            tooltipPosition="top"
            data-testid="dashboard-meeting-card-public-icon">
            <i class="fa-light fa-users text-xs text-gray-800"></i>
          </div>
        }
      </div>
    </div>

    <!-- Meeting title -->
    <div class="flex items-start justify-between gap-2">
      <h4 class="line-clamp-2 text-sm leading-5 flex-1 font-medium text-gray-900" data-testid="dashboard-meeting-card-title">
        {{ meetingTitle() }}
      </h4>
      @if (attachments().length > 0) {
        <div class="flex items-center gap-1 flex-shrink-0 mt-0.5">
          @for (attachment of attachments(); track attachment.id; let index = $index) {
            <a
              [href]="attachment.file_url"
              target="_blank"
              rel="noopener noreferrer"
              class="w-6 h-6 rounded bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors"
              [attr.data-testid]="'dashboard-meeting-card-file-icon-' + (index + 1)"
              [pTooltip]="attachment.file_name"
              tooltipPosition="top">
              <i [class]="(attachment.mime_type || '' | fileTypeIcon) + ' text-xs text-gray-500'"></i>
            </a>
          }
        </div>
      }
    </div>

    <!-- Meeting time and actions -->
    <div class="space-y-2">
      <div class="flex items-center justify-between">
        <div class="flex flex-col gap-1">
          <!-- RSVP Section - Compact Top Left -->
          <div class="inline-flex items-center gap-1 bg-gray-50 rounded-lg p-1" data-testid="dashboard-meeting-card-rsvp-section">
            <span class="text-[10px] font-medium text-gray-500 uppercase px-1">RSVP</span>
            <button
              type="button"
              (click)="handleRsvpClick('accepted')"
              [disabled]="rsvpLoading()"
              [class]="
                'px-2 py-0.5 text-[11px] font-medium rounded transition-colors ' +
                (userRsvp()?.response === 'accepted'
                  ? 'bg-green-500 text-white border border-green-600'
                  : 'bg-white text-gray-600 border border-gray-200 hover:bg-gray-100')
              "
              data-testid="dashboard-meeting-card-rsvp-yes">
              Yes
            </button>
            <button
              type="button"
              (click)="handleRsvpClick('maybe')"
              [disabled]="rsvpLoading()"
              [class]="
                'px-2 py-0.5 text-[11px] font-medium rounded transition-colors ' +
                (userRsvp()?.response === 'maybe'
                  ? 'bg-yellow-500 text-white border border-yellow-600'
                  : 'bg-white text-gray-600 border border-gray-200 hover:bg-gray-100')
              "
              data-testid="dashboard-meeting-card-rsvp-maybe">
              Maybe
            </button>
            <button
              type="button"
              (click)="handleRsvpClick('declined')"
              [disabled]="rsvpLoading()"
              [class]="
                'px-2 py-0.5 text-[11px] font-medium rounded transition-colors ' +
                (userRsvp()?.response === 'declined'
                  ? 'bg-red-500 text-white border border-red-600'
                  : 'bg-white text-gray-600 border border-gray-200 hover:bg-gray-100')
              "
              data-testid="dashboard-meeting-card-rsvp-no">
              No
            </button>
          </div>
          <div class="flex items-center gap-1 text-gray-600" data-testid="dashboard-meeting-card-time">
            <i class="fa-light fa-clock text-xs"></i>
            <span class="text-xs">{{ formattedTime() }}</span>
          </div>
        </div>
        <lfx-button
          label="See Meeting"
          icon="fa-light fa-arrow-right"
          iconPos="right"
          (onClick)="handleSeeMeeting()"
          styleClass="text-[#0094FF] hover:text-[#0094FF] hover:bg-blue-50 !h-7 !px-2 !text-xs !font-normal"
          [text]="true"
          data-testid="dashboard-meeting-card-see-button" />
      </div>

      <!-- Join Meeting button for today's meetings -->
      @if (isTodayMeeting()) {
        <lfx-button
          label="Join Meeting"
          [routerLink]="['/meetings', meeting().uid]"
          [queryParams]="{ password: meeting().password || '' }"
          target="_blank"
          type="button"
          rel="noopener noreferrer"
          styleClass="w-full mt-1 bg-emerald-500 hover:bg-emerald-600 text-white h-7 text-xs font-semibold"
          data-testid="dashboard-meeting-card-join-button" />
      }
    </div>
  </div>
</div>
