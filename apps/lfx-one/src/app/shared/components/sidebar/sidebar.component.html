<!-- Copyright The Linux Foundation and each contributor to LFX. -->
<!-- SPDX-License-Identifier: MIT -->

<aside
  class="h-full bg-white w-72 flex flex-col"
  [ngClass]="{
    'border-r border-gray-200': !mobile(),
  }"
  data-testid="sidebar">
  <div class="flex flex-col py-6 h-full min-h-0 overflow-y-auto">
    <!-- Top Navigation -->
    <div class="flex flex-col items-start w-full flex-1">
      <!-- LFX One Logo - Hidden on mobile (shown in drawer header instead) -->
      @if (!mobile()) {
        <div class="h-[20px] ml-2 w-[141.6px] px-3 py-3 mb-12">
          <a [routerLink]="['/']" class="flex items-center">
            <!-- LFX One Logo SVG -->
            <img src="/images/lfx-one-logo.svg" alt="LFX Logo" class="w-auto h-5" />
          </a>
        </div>
      }

      <!-- Project Selector -->
      @if (showProjectSelector()) {
        <div class="px-3 mb-6 w-full">
          <lfx-project-selector
            [projects]="foundationProjects()"
            [selectedProject]="selectedProject()"
            (projectChange)="onProjectChange($event)"></lfx-project-selector>
        </div>
      }

      <!-- Main Navigation Items -->
      <div class="flex flex-col gap-2 items-start px-3 w-full">
        @for (item of itemsWithTestIds(); track item.label) {
          @if (item.isSection) {
            <!-- Section Header -->
            <div class="w-full" [attr.data-testid]="item.testId">
              <!-- Divider -->
              <div class="h-px bg-gray-200 my-2"></div>

              <!-- Section Toggle Button -->
              <button
                type="button"
                (click)="onSectionToggle(item.label, item.isExpanded)"
                class="w-full px-2 py-1.5 flex items-center justify-between hover:bg-gray-50 rounded-md transition-colors"
                [attr.data-testid]="item.testId + '-toggle'"
                [attr.aria-expanded]="item.isExpanded"
                [attr.aria-label]="'Toggle ' + item.label + ' section'">
                <span class="text-xs font-medium text-gray-400 uppercase tracking-wide">{{ item.label }}</span>
                <i class="fa-solid w-3 h-3 text-gray-400 transition-transform" [ngClass]="item.isExpanded ? 'fa-chevron-down' : 'fa-chevron-right'"></i>
              </button>

              <!-- Section Items -->
              @if (item.isExpanded && item.items?.length) {
                <div class="flex flex-col gap-1 mt-2">
                  @for (childItem of item.items; track childItem.label) {
                    <ng-container *ngTemplateOutlet="menuItem; context: { $implicit: childItem }"></ng-container>
                  }
                </div>
              }
            </div>
          } @else {
            <ng-container *ngTemplateOutlet="menuItem; context: { $implicit: item }"></ng-container>
          }
        }
      </div>
    </div>

    <!-- Bottom Navigation (stays at bottom when space allows, scrolls with content otherwise) -->
    <div class="flex flex-col gap-2 items-start px-3 w-full mt-auto pt-4">
      @if (footerItems().length > 0) {
        @for (item of footerItemsWithTestIds(); track item.label) {
          <ng-container *ngTemplateOutlet="menuItem; context: { $implicit: item }"></ng-container>
        }
      }
    </div>
  </div>
</aside>

<!-- Menu Item Template -->
<ng-template #menuItem let-item>
  @if (item.routerLink) {
    <a
      [routerLink]="item.routerLink"
      routerLinkActive="bg-blue-100 font-medium text-gray-950"
      [routerLinkActiveOptions]="{ exact: true }"
      class="flex items-center gap-2 px-2 py-2 rounded-lg transition-colors cursor-pointer w-full text-base !text-gray-950 font-normal hover:bg-gray-50"
      [ngClass]="{
        'opacity-50 pointer-events-none cursor-not-allowed': item.disabled,
      }"
      [attr.data-testid]="item.testId"
      [attr.aria-label]="item.label">
      <div class="flex items-center justify-center shrink-0 w-6 h-6">
        <i [ngClass]="[item.icon, 'w-5']"></i>
      </div>
      <span class="whitespace-nowrap">{{ item.label }}</span>

      @if (item.badge) {
        <lfx-badge [value]="item.badge" [severity]="item.badgeSeverity || 'info'" size="small" styleClass="ml-auto"></lfx-badge>
      }
    </a>
  }

  @if (item.url) {
    <a
      [href]="item.url"
      [target]="item.target || '_blank'"
      [rel]="item.rel || 'noopener noreferrer'"
      class="flex items-center justify-between gap-2 px-2 py-2 rounded-lg transition-colors cursor-pointer w-full text-base !text-gray-950 font-normal hover:bg-gray-50"
      [ngClass]="{
        'opacity-50 pointer-events-none cursor-not-allowed': item.disabled,
      }"
      [attr.data-testid]="item.testId"
      [attr.aria-label]="item.label">
      <div class="flex items-center gap-2">
        <div class="flex items-center justify-center shrink-0 w-6 h-6">
          <i [ngClass]="[item.icon, 'w-5']"></i>
        </div>
        <span class="whitespace-nowrap">{{ item.label }}</span>
        @if (item.badge) {
          <lfx-badge [value]="item.badge" [severity]="item.badgeSeverity || 'info'" size="small"></lfx-badge>
        }
      </div>
      <i class="fa-light fa-arrow-up-right-from-square text-gray-400 text-xs"></i>
    </a>
  }

  @if (item.command && !item.routerLink && !item.url) {
    <button
      type="button"
      (click)="item.command()"
      class="flex items-center gap-2 px-2 py-2 rounded-lg transition-colors cursor-pointer w-full text-left text-base !text-gray-950 font-normal hover:bg-gray-50"
      [ngClass]="{
        'opacity-50 cursor-not-allowed': item.disabled,
      }"
      [disabled]="item.disabled"
      [attr.data-testid]="item.testId"
      [attr.aria-label]="item.label">
      <div class="flex items-center justify-center shrink-0 w-6 h-6">
        <i [ngClass]="[item.icon, 'w-5']"></i>
      </div>
      <span class="whitespace-nowrap">{{ item.label }}</span>

      @if (item.badge) {
        <lfx-badge [value]="item.badge" [severity]="item.badgeSeverity || 'info'" size="small" styleClass="ml-auto"></lfx-badge>
      }
    </button>
  }
</ng-template>
