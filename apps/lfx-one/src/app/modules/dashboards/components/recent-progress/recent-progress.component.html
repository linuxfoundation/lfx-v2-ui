<!-- Copyright The Linux Foundation and each contributor to LFX. -->
<!-- SPDX-License-Identifier: MIT -->

<section data-testid="dashboard-recent-progress-section">
  <div class="flex items-center justify-between mb-4">
    <div class="flex flex-col md:flex-row md:items-center gap-3">
      <h2>ðŸ“ˆ <span class="ml-1">Recent Progress</span></h2>

      <!-- Filter Pills - Only show for maintainers -->
      @if (showFilterPills()) {
        <lfx-filter-pills [options]="filterOptions" [selectedFilter]="selectedFilter()" (filterChange)="setFilter($event)" />
      }
    </div>

    <div class="flex items-center gap-3">
      <!-- Carousel Controls -->
      <div class="flex items-center gap-2">
        <button
          type="button"
          (click)="scrollLeft()"
          class="h-8 w-8 p-0 flex items-center justify-center rounded border border-gray-300 bg-white text-gray-600 hover:bg-gray-100 hover:border-gray-400 transition-colors"
          data-testid="dashboard-recent-progress-scroll-left"
          aria-label="Scroll left">
          <i class="fa-light fa-chevron-left"></i>
        </button>
        <button
          type="button"
          (click)="scrollRight()"
          class="h-8 w-8 p-0 flex items-center justify-center rounded border border-gray-300 bg-white text-gray-600 hover:bg-gray-100 hover:border-gray-400 transition-colors"
          data-testid="dashboard-recent-progress-scroll-right"
          aria-label="Scroll right">
          <i class="fa-light fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

  @if (isLoading()) {
    <!-- Loading State -->
    <div class="flex items-center justify-center p-12">
      <div class="text-center space-y-3">
        <i class="fa-light fa-spinner-third fa-spin text-4xl text-blue-500"></i>
        <p class="text-sm text-gray-500">Loading project data...</p>
      </div>
    </div>
  } @else {
    <div class="overflow-hidden">
      <div #progressScroll class="flex gap-4 overflow-x-auto pb-2 hide-scrollbar scroll-smooth" data-testid="dashboard-recent-progress-items">
        @for (item of filteredProgressItems(); track item.title) {
          <lfx-metric-card
            [title]="item.title"
            [icon]="item.icon"
            [testId]="'dashboard-recent-progress-item-' + item.title"
            [chartType]="item.chartType"
            [chartData]="item.chartData"
            [chartOptions]="item.chartOptions"
            [value]="item.value"
            [subtitle]="item.subtitle"
            [valueTooltip]="item.tooltipText"
            [showConnectedIndicator]="true"
            [isConnected]="item.isConnected ?? false"></lfx-metric-card>
        }
      </div>
    </div>
  }
</section>
