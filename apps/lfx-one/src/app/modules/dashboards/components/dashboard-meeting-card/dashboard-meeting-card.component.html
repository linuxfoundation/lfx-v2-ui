<!-- Copyright The Linux Foundation and each contributor to LFX. -->
<!-- SPDX-License-Identifier: MIT -->

<!-- Card wrapper with border and shadow -->
<div class="bg-white rounded-xl border shadow-md hover:border-blue-500 transition-all" data-testid="dashboard-meeting-card">
  <div class="p-4 space-y-3">
    <!-- Header with meeting type and project badges -->
    <div class="flex items-center gap-2 flex-wrap">
      <lfx-tag
        [value]="meetingTypeInfo().label"
        [severity]="meetingTypeInfo().severity"
        [icon]="meetingTypeInfo().icon"
        data-testid="dashboard-meeting-card-type-badge"></lfx-tag>
    </div>

    <!-- Meeting title with file icons -->
    <div class="flex items-start justify-between gap-2">
      <div class="flex flex-col gap-1 truncate max-w-full">
        <h4
          class="line-clamp-2 text-sm leading-tight font-medium text-gray-900 truncate"
          data-testid="dashboard-meeting-card-title"
          [pTooltip]="meetingTitle()">
          {{ meetingTitle() }}
        </h4>
        <!-- Date/time with feature icons - directly under title -->
        <div class="flex items-center gap-2 flex-wrap mt-0.5 h-4">
          <span class="text-xs text-gray-600 whitespace-nowrap" data-testid="dashboard-meeting-card-time">
            {{ formattedTime() }}
          </span>
          <div class="flex items-center gap-1">
            @if (hasYoutubeUploads()) {
              <div
                class="flex p-1 hover:bg-gray-100 rounded transition-colors"
                pTooltip="YouTube Auto-Upload Enabled"
                tooltipPosition="top"
                data-testid="dashboard-meeting-card-youtube-icon">
                <i class="fa-light fa-upload text-xs text-gray-700"></i>
              </div>
            }
            @if (hasRecording()) {
              <div
                class="flex p-1 hover:bg-gray-100 rounded transition-colors"
                pTooltip="Recording Enabled"
                tooltipPosition="top"
                data-testid="dashboard-meeting-card-recording-icon">
                <i class="fa-light fa-video text-xs text-gray-700"></i>
              </div>
            }
            @if (hasTranscripts()) {
              <div
                class="flex p-1 hover:bg-gray-100 rounded transition-colors"
                pTooltip="Transcripts Enabled"
                tooltipPosition="top"
                data-testid="dashboard-meeting-card-transcript-icon">
                <i class="fa-light fa-file-lines text-xs text-gray-700"></i>
              </div>
            }
            @if (hasAiSummary()) {
              <div
                class="flex p-1 hover:bg-gray-100 rounded transition-colors"
                pTooltip="AI Summary Enabled"
                tooltipPosition="top"
                data-testid="dashboard-meeting-card-ai-icon">
                <i class="fa-light fa-sparkles text-xs text-gray-700"></i>
              </div>
            }
            @if (!isPrivate()) {
              <div
                class="flex p-1 hover:bg-gray-100 rounded transition-colors"
                pTooltip="Public Meeting"
                tooltipPosition="top"
                data-testid="dashboard-meeting-card-public-icon">
                <i class="fa-light fa-users text-xs text-gray-700"></i>
              </div>
            }
          </div>
        </div>
      </div>
      @if (attachments().length > 0) {
        <div class="flex items-center gap-1 flex-shrink-0 mt-0.5">
          @for (attachment of attachments(); track attachment.uid; let index = $index) {
            <a
              [href]="attachment.type === 'link' ? attachment.link : '/api/meetings/' + meeting().uid + '/attachments/' + attachment.uid"
              target="_blank"
              rel="noopener noreferrer"
              [download]="attachment.type === 'file' ? attachment.name : null"
              class="w-6 h-6 rounded bg-blue-50 flex items-center justify-center hover:bg-blue-100 transition-colors cursor-pointer"
              [attr.data-testid]="'dashboard-meeting-card-file-icon-' + (index + 1)"
              [pTooltip]="attachment.name"
              tooltipPosition="top">
              <i class="text-xs text-primary" [ngClass]="attachment.mime_type || '' | fileTypeIcon"></i>
            </a>
          }
        </div>
      }
    </div>

    <!-- Action buttons -->
    <div class="flex gap-2">
      <!-- See Meeting button - full width when alone, flex-1 when both buttons present -->
      <lfx-button
        class="w-full"
        label="See Meeting Details"
        [href]="meetingDetailUrl()"
        target="_blank"
        type="button"
        rel="noopener noreferrer"
        [styleClass]="'border border-gray-300 text-gray-900 hover:bg-gray-50 h-8 text-sm font-medium w-full'"
        [outlined]="true"
        icon="fa-light fa-up-right-from-square text-xs"
        data-testid="dashboard-meeting-card-see-button" />

      <!-- Join Meeting button - right side when present -->
      @if (canJoinMeeting()) {
        @if (joinUrl()) {
          <!-- Direct join URL available -->
          <lfx-button
            class="w-full"
            size="small"
            label="Join Meeting"
            [href]="joinUrl()!"
            target="_blank"
            type="button"
            rel="noopener noreferrer"
            icon="fa-light fa-video"
            styleClass="w-full bg-emerald-500 hover:bg-emerald-600 text-white h-8 text-sm font-semibold"
            data-testid="dashboard-meeting-card-join-button" />
        }
      }
    </div>
  </div>
</div>
