<!-- Copyright The Linux Foundation and each contributor to LFX. -->
<!-- SPDX-License-Identifier: MIT -->

<section class="flex flex-col flex-1" data-testid="dashboard-my-meetings-section">
  <!-- Header -->
  <div class="flex items-center justify-between mb-4">
    <h2>My Meetings</h2>
    <lfx-button
      label="View All"
      icon="fa-light fa-chevron-right"
      iconPos="right"
      [routerLink]="['/meetings']"
      styleClass="!text-sm !font-normal"
      [text]="true"
      size="small"
      data-testid="dashboard-my-meetings-view-all" />
  </div>

  <!-- Scrollable Content -->
  <div class="relative flex flex-col flex-1 -my-1">
    @if (loading()) {
      <div class="flex flex-col gap-3" data-testid="dashboard-my-meetings-loading">
        <p-skeleton width="100%" height="140px"></p-skeleton>
        <p-skeleton width="100%" height="140px"></p-skeleton>
      </div>
    } @else {
      <!-- Top Fade Gradient -->
      @if (canScrollUp()) {
        <div class="absolute top-0 left-0 right-0 h-16 pointer-events-none z-10" style="background: linear-gradient(to bottom, #f8f8f9 0%, transparent 100%);"></div>
      }
      
      <!-- Bottom Fade Gradient -->
      @if (canScrollDown()) {
        <div class="absolute bottom-0 left-0 right-0 h-16 pointer-events-none z-10" style="background: linear-gradient(to top, #f8f8f9 0%, transparent 100%);"></div>
      }
      
      <div #scrollContainer class="flex flex-col gap-6 overflow-scroll max-h-[30rem] px-1 -mx-1 py-1" (scroll)="onScroll()" data-testid="dashboard-my-meetings-list">
        @if (todayMeetings().length > 0 || upcomingMeetings().length > 0) {
          <!-- TODAY Section - only show if there are meetings today -->
          @if (todayMeetings().length > 0) {
            <div>
              <h4 class="text-gray-500 mb-3">Today</h4>
              <div class="flex flex-col gap-3">
                @for (item of todayMeetings(); track item.meeting.uid) {
                  <lfx-dashboard-meeting-card
                    [meeting]="item.meeting"
                    [occurrence]="item.occurrence"
                    [attr.data-testid]="'dashboard-my-meetings-today-item-' + item.meeting.uid" />
                }
              </div>
            </div>
          }

          <!-- UPCOMING Section - only show if there are upcoming meetings -->
          @if (upcomingMeetings().length > 0) {
            <div>
              <h4 class="text-gray-500 mb-3">Upcoming</h4>
              <div class="flex flex-col gap-3">
                @for (item of upcomingMeetings(); track item.meeting.uid) {
                  <lfx-dashboard-meeting-card
                    [meeting]="item.meeting"
                    [occurrence]="item.occurrence"
                    [attr.data-testid]="'dashboard-my-meetings-upcoming-item-' + item.meeting.uid" />
                }
              </div>
            </div>
          }
        } @else {
          <!-- Global empty state - only shows when no meetings at all -->
          <div class="text-xs text-gray-500 py-8 text-center border-2 border-dashed border-gray-300 rounded-lg" data-testid="dashboard-my-meetings-empty">
            No meetings scheduled
          </div>
        }
      </div>
    }
  </div>
</section>
