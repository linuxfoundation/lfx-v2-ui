<!-- Copyright The Linux Foundation and each contributor to LFX. -->
<!-- SPDX-License-Identifier: MIT -->

<lfx-card>
  <!-- Filter Bar Inside Card -->
  <div class="pb-2 mb-2">
    <div class="flex flex-col md:flex-row md:items-center gap-3 md:gap-4">
      <!-- Search Input -->
      <div class="flex-1">
        <lfx-input-text
          [form]="searchForm()"
          control="search"
          placeholder="Search committees..."
          icon="fa-light fa-search"
          styleClass="w-full"
          size="small"
          data-testid="committee-search-input"></lfx-input-text>
      </div>

      <!-- Category Filter Dropdown -->
      <div class="w-full sm:w-64">
        <lfx-select
          [form]="searchForm()"
          control="category"
          size="small"
          [options]="categoryOptions()"
          placeholder="Select Type"
          [showClear]="true"
          styleClass="w-full"
          data-testid="committee-type-filter"></lfx-select>
      </div>

      <!-- Voting Status Filter Dropdown -->
      <div class="w-full sm:w-64">
        <lfx-select
          [form]="searchForm()"
          control="votingStatus"
          size="small"
          [options]="votingStatusOptions()"
          placeholder="Select Voting Status"
          [showClear]="true"
          styleClass="w-full"
          data-testid="committee-voting-status-filter"></lfx-select>
      </div>
    </div>
  </div>

  <lfx-table
    [value]="committees()"
    [paginator]="committees().length > 10"
    [rows]="10"
    [rowsPerPageOptions]="[10, 25, 50]"
    sortField="name"
    [sortOrder]="1"
    data-testid="committee-dashboard-table">
    <ng-template #header>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th class="min-w-[300px]">Description</th>
        <th>Members</th>
        <th>Voting</th>
        <th>Last Updated</th>
        @if (canManageCommittee()) {
          <th></th>
        }
      </tr>
    </ng-template>
    <ng-template #body let-committee>
      <tr [attr.data-testid]="'committee-row-' + committee.uid">
        <td>
          <div class="flex items-center gap-2">
            @if (isBoardMember()) {
              <span class="text-sm font-medium">{{ committee.name || '-' }}</span>
            } @else {
              <a [routerLink]="['/groups', committee.uid]" class="text-sm font-medium">
                {{ committee.name || '-' }}
              </a>
            }
            @if (!committee.public) {
              <i class="fa-light fa-lock w-3 h-3 text-gray-500" pTooltip="Private" tooltipPosition="top"></i>
            }
          </div>
        </td>
        <td>
          @let category = committee.category || 'Other';
          <lfx-tag [value]="category" [severity]="category | committeeCategorySeverity"></lfx-tag>
        </td>
        <td class="min-w-[300px]">
          <div class="max-w-[300px] line-clamp-2 text-xs">{{ committee.description || '-' }}</div>
        </td>
        <td>
          <a [routerLink]="['/groups', committee.uid]">
            {{ committee.total_members || 0 }}
          </a>
        </td>
        <td>
          @if (committee.enable_voting) {
            <i class="fa-light fa-check w-4 h-4 text-emerald-600"></i>
          }
        </td>
        <td>{{ committee.updated_at | date: 'MMM d, y' }}</td>
        @if (canManageCommittee()) {
          <td>
            <div class="flex items-center justify-end gap-1">
              <lfx-button
                icon="fa-light fa-user-plus"
                severity="secondary"
                size="small"
                [text]="true"
                styleClass="h-8 w-8 text-gray-500 hover:text-gray-700 hover:bg-gray-100"
                (onClick)="onAddMember(committee)"
                [attr.data-testid]="'committee-add-member-' + committee.uid"
                [pTooltip]="'Add Member'"
                tooltipPosition="top">
              </lfx-button>
              <a [routerLink]="['/groups', committee.uid, 'edit']">
                <lfx-button
                  icon="fa-light fa-pencil"
                  severity="secondary"
                  size="small"
                  [outlined]="false"
                  [text]="true"
                  styleClass="h-8 w-8 text-gray-500 hover:text-gray-700 hover:bg-gray-100"
                  [attr.data-testid]="'committee-edit-' + committee.uid"
                  [pTooltip]="'Edit ' + committeeLabel()"
                  tooltipPosition="top">
                </lfx-button>
              </a>
              <lfx-button
                icon="fa-light fa-trash-can"
                severity="secondary"
                size="small"
                [text]="true"
                styleClass="h-8 w-8 text-gray-500 hover:text-gray-700 hover:bg-gray-100"
                (onClick)="onDeleteCommittee(committee)"
                [disabled]="isDeleting()"
                [attr.data-testid]="'committee-delete-' + committee.uid"
                [pTooltip]="'Delete ' + committeeLabel()"
                tooltipPosition="top">
              </lfx-button>
            </div>
          </td>
        }
      </tr>
    </ng-template>
    <ng-template #emptymessage>
      <tr>
        <td [attr.colspan]="canManageCommittee() ? 7 : 6">
          <i class="fa-light fa-folder-open text-3xl text-gray-400 mb-2"></i>
          <p class="text-sm text-gray-500">No {{ committeeLabel().toLowerCase() }}s found</p>
        </td>
      </tr>
    </ng-template>
  </lfx-table>
</lfx-card>

<!-- Confirmation Dialog -->
<p-confirmDialog></p-confirmDialog>
