<!-- Copyright The Linux Foundation and each contributor to LFX. -->
<!-- SPDX-License-Identifier: MIT -->
@if (loading()) {
  <div class="flex justify-center items-center min-h-96">
    <div class="text-center">
      <i class="fa-light fa-spinner-third fa-spin text-3xl text-blue-600 mb-4"></i>
      <p class="text-gray-600">Loading user permissions...</p>
    </div>
  </div>
}

@if (!loading()) {
  <lfx-card header="Permissions">
    @if (users().length > 0) {
      <lfx-table
        [value]="users()"
        size="small"
        styleClass="p-datatable-sm animate-fade-in-up"
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[10, 25, 50]"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} users">
        <ng-template #header>
          <tr>
            <th class="w-16"><span class="text-sm font-sans text-gray-500">Avatar</span></th>
            <th><span class="text-sm font-sans text-gray-500">Name</span></th>
            <th><span class="text-sm font-sans text-gray-500">Username</span></th>
            <th><span class="text-sm font-sans text-gray-500">Email</span></th>
            <th><span class="text-sm font-sans text-gray-500">Role</span></th>
            <th class="text-center">
              <div class="flex justify-center">
                <span class="text-sm font-sans text-gray-500">Actions</span>
              </div>
            </th>
          </tr>
        </ng-template>

        <ng-template #body let-user>
          <tr>
            <!-- Avatar Column -->
            <td>
              <div class="flex items-center justify-center">
                @if (user.avatar) {
                  <img [src]="user.avatar" [alt]="user.name" class="w-8 h-8 rounded-full object-cover" />
                } @else {
                  <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white text-xs font-medium">
                    {{ getUserInitials(user.name) }}
                  </div>
                }
              </div>
            </td>

            <!-- Name Column -->
            <td>
              <div class="text-sm font-sans text-gray-900 font-medium">{{ user.name }}</div>
            </td>

            <!-- Username Column -->
            <td>
              <div class="text-sm font-sans text-gray-700">{{ user.username }}</div>
            </td>

            <!-- Email Column -->
            <td>
              <div class="text-sm font-sans text-gray-600">{{ user.email }}</div>
            </td>

            <!-- Role Column -->
            <td>
              <span class="text-sm font-sans {{ user.role === 'manage' ? 'text-green-700 font-medium' : 'text-blue-600' }}">
                {{ user.role === 'manage' ? 'Manage' : 'View' }}
              </span>
            </td>

            <!-- Actions Column -->
            <td class="text-center relative">
              <lfx-menu #userActionMenu [model]="userActionMenuItems" [popup]="true" appendTo="body"></lfx-menu>
              <lfx-button
                [icon]="isRemoving() === user.username ? 'fa-light fa-circle-notch fa-spin' : 'fa-light fa-ellipsis-vertical'"
                [text]="true"
                [rounded]="true"
                size="small"
                severity="secondary"
                [disabled]="isRemoving() === user.username"
                (onClick)="toggleUserActionMenu($event, user, userActionMenu)"
                data-testid="user-actions-menu">
              </lfx-button>
            </td>
          </tr>
        </ng-template>

        <ng-template #emptymessage>
          <tr>
            <td colspan="6" class="text-center py-8">
              <div class="text-center py-8 text-gray-500">
                <i class="fa-light fa-users text-4xl text-gray-400 mb-4"></i>
                <h3 class="text-lg font-medium text-gray-900 mb-2">No User Permissions</h3>
                <p class="text-gray-600">No users have been assigned permissions to this project yet.</p>
              </div>
            </td>
          </tr>
        </ng-template>
      </lfx-table>
    } @else {
      <div class="flex justify-center items-center h-full">
        <div class="text-center py-8">
          <i class="fa-light fa-users text-4xl text-gray-400 mb-4"></i>
          <h3 class="text-lg font-medium text-gray-900 mb-2">No User Permissions</h3>
          <p class="text-gray-600">No users have been assigned permissions to this project yet.</p>
        </div>
      </div>
    }
  </lfx-card>
}

<!-- Confirmation Dialog -->
<p-confirmDialog></p-confirmDialog>
