<!-- Copyright The Linux Foundation and each contributor to LFX. -->
<!-- SPDX-License-Identifier: MIT -->

<div class="container px-8" data-testid="vote-manage">
  <!-- Back Navigation -->
  <div class="mb-4">
    <a routerLink="/votes" class="inline-flex items-center text-gray-500 hover:text-gray-700 transition-colors">
      <i class="fa-light fa-arrow-left mr-2"></i>
      Back to {{ voteLabel.plural }}
    </a>
  </div>

  <!-- Page Title -->
  <h1 class="mb-6" data-testid="vote-manage-title">
    {{ isEditMode() ? 'Edit ' + voteLabel.singular : 'Create ' + voteLabel.singular }}
  </h1>

  <!-- Stepper -->
  <p-stepper
    [value]="currentStep()"
    (valueChange)="goToStep($event)"
    [linear]="!isEditMode()"
    styleClass="vote-manage-stepper mb-6"
    data-testid="vote-manage-stepper">
    <p-step-list>
      <p-step [value]="1" data-testid="vote-manage-step-1"></p-step>
      <p-step [value]="2" data-testid="vote-manage-step-2"></p-step>
      <p-step [value]="3" data-testid="vote-manage-step-3"></p-step>
    </p-step-list>

    <p-step-panels>
      <!-- Form Card -->
      <div class="bg-white rounded-lg border border-gray-200 shadow-sm px-7">
        <!-- Navigation Controls (Above Content) -->
        <div class="flex items-center justify-between p-6 border-b border-gray-200">
          <!-- Previous Button -->
          <div>
            @if (canGoPrevious()) {
              <lfx-button label="Previous" icon="fa-light fa-chevron-left" [text]="true" (onClick)="previousStep()" data-testid="vote-manage-previous-btn">
              </lfx-button>
            }
          </div>

          <!-- Right Side Buttons -->
          <div class="flex gap-3">
            <!-- Cancel Button - Always visible -->
            <lfx-button label="Cancel" [outlined]="true" styleClass="border-0 text-gray-950" (onClick)="onCancel()" data-testid="vote-manage-cancel-btn">
            </lfx-button>

            <!-- Save as Draft Button - Always visible -->
            <lfx-button label="Save as Draft" severity="secondary" [outlined]="true" (onClick)="onSaveAsDraft()" data-testid="vote-manage-draft-btn">
            </lfx-button>

            @if (isLastStep()) {
              <!-- Create/Update Button -->
              <lfx-button
                [label]="isEditMode() ? 'Save Changes' : 'Create ' + voteLabel.singular"
                [loading]="submitting()"
                severity="info"
                (onClick)="onSubmit()"
                data-testid="vote-manage-submit-btn">
              </lfx-button>
            } @else {
              <!-- Next Button -->
              <lfx-button
                label="Next"
                icon="fa-light fa-chevron-right"
                iconPos="right"
                [disabled]="!canGoNext()"
                severity="info"
                (onClick)="nextStep()"
                data-testid="vote-manage-next-btn">
              </lfx-button>
            }
          </div>
        </div>

        <!-- Step Content -->
        <div class="p-6 md:p-8 min-h-[680px]">
          <p-step-panel [value]="1" data-testid="vote-manage-panel-1">
            <ng-template #content>
              <lfx-vote-basics [form]="form()" [formValue]="formValue" [isEditMode]="isEditMode()"> </lfx-vote-basics>
            </ng-template>
          </p-step-panel>

          <p-step-panel [value]="2" data-testid="vote-manage-panel-2">
            <ng-template #content>
              <lfx-vote-question
                [form]="form()"
                [formValue]="formValue"
                [isEditMode]="isEditMode()"
                [createQuestionFormGroup]="createQuestionFormGroup.bind(this)">
              </lfx-vote-question>
            </ng-template>
          </p-step-panel>

          <p-step-panel [value]="3" data-testid="vote-manage-panel-3">
            <ng-template #content>
              <!-- Step 3: Review & Confirm - To be implemented -->
              <div class="flex flex-col gap-6">
                <div>
                  <h2 class="text-lg font-semibold text-gray-900 mb-1">Review & Confirm</h2>
                  <p class="text-sm text-gray-500">Please review your vote details before creating</p>
                </div>

                <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                  <p class="text-gray-500 text-sm">Step 3 content will be implemented in the next phase.</p>
                </div>
              </div>
            </ng-template>
          </p-step-panel>
        </div>
      </div>
    </p-step-panels>
  </p-stepper>
</div>
