<!-- Copyright The Linux Foundation and each contributor to LFX. -->
<!-- SPDX-License-Identifier: MIT -->

<div class="border border-gray-200 rounded-lg p-4">
  <!-- Header -->
  <div class="mb-4">
    <p class="text-neutral-950 mb-1">Custom Recurrence Pattern</p>
    <p class="text-sm text-gray-600">Configure a custom recurring pattern for this meeting</p>
  </div>

  <!-- Form Content -->
  <div class="flex flex-col gap-4" [formGroup]="recurrenceForm()">
    <!-- Section 1: Pattern Selection -->
    <div class="border-b border-gray-100 pb-4">
      <label class="block text-neutral-950 mb-2">Repeat Pattern</label>

      <div class="flex items-center gap-3 flex-wrap">
        <span class="text-sm text-gray-600">Repeat every</span>

        <lfx-input-text
          [form]="recurrenceForm()"
          control="repeat_interval"
          type="number"
          placeholder="1"
          styleClass="w-20"
          data-testid="recurrence-interval-input">
        </lfx-input-text>

        <lfx-select [form]="form()" control="patternTypeUI" [options]="patternTypeOptions" styleClass="min-w-24" data-testid="recurrence-pattern-type-select">
        </lfx-select>
      </div>
    </div>

    <!-- Section 2: Pattern Details -->
    <div class="border-b border-gray-100 pb-4">
      <label class="block text-neutral-950 mb-2">Pattern Details</label>

      <!-- Weekly Pattern Details -->
      @if (patternType() === 'weekly') {
        <div class="flex flex-col gap-3">
          <p class="text-sm text-gray-600 mb-2">Repeat on:</p>
          <div class="grid grid-cols-7 gap-2">
            @for (day of daysOfWeek; track day.value; let i = $index) {
              <label
                class="flex flex-col items-center p-2 border border-gray-200 rounded-md cursor-pointer transition-colors hover:bg-gray-50"
                [class.bg-blue-50]="isWeeklyDaySelected(i)"
                [class.border-blue-300]="isWeeklyDaySelected(i)"
                [attr.data-testid]="'recurrence-day-' + day.label.toLowerCase()">
                <input type="checkbox" [checked]="isWeeklyDaySelected(i)" (change)="onWeeklyDayChange(i, $event)" class="sr-only" />
                <span class="text-xs font-medium text-gray-700">{{ day.label }}</span>
              </label>
            }
          </div>
        </div>
      }

      <!-- Monthly Pattern Details -->
      @if (patternType() === 'monthly') {
        <div class="flex flex-col gap-4">
          <div class="flex flex-col gap-2">
            @for (option of monthlyTypeOptions; track option.value) {
              <label class="flex items-center gap-2 cursor-pointer" [attr.data-testid]="'recurrence-monthly-' + option.value">
                <lfx-radio-button [form]="recurrenceForm()" control="monthlyTypeUI" [value]="option.value" name="monthlyTypeUI"> </lfx-radio-button>
                <span class="text-sm text-gray-600">{{ option.label }}</span>
              </label>
            }
          </div>

          <!-- Day of Month Option -->
          @if (monthlyType() === 'dayOfMonth') {
            <div class="flex items-center gap-2 flex-wrap pl-6">
              <span class="text-sm text-gray-600">On day</span>
              <lfx-input-text
                [form]="recurrenceForm()"
                control="monthly_day"
                type="number"
                placeholder="1"
                styleClass="w-16"
                data-testid="recurrence-monthly-day">
              </lfx-input-text>
              <span class="text-sm text-gray-600">of the month</span>
            </div>
          }

          <!-- Day of Week Option -->
          @if (monthlyType() === 'dayOfWeek') {
            <div class="flex items-center gap-2 flex-wrap pl-6">
              <span class="text-sm text-gray-600">On the</span>
              <lfx-select
                [form]="recurrenceForm()"
                control="monthly_week"
                [options]="weeklyOrdinals"
                styleClass="min-w-16"
                data-testid="recurrence-monthly-week">
              </lfx-select>
              <lfx-select
                [form]="recurrenceForm()"
                control="monthly_week_day"
                [options]="daysOfWeek"
                [optionLabel]="'fullLabel'"
                [optionValue]="'value'"
                styleClass="min-w-24"
                data-testid="recurrence-monthly-weekday">
              </lfx-select>
            </div>
          }
        </div>
      }

      <!-- Daily Pattern (no additional details needed) -->
      @if (patternType() === 'daily') {
        <div>
          <p class="text-sm text-gray-600 italic">Meeting will repeat every {{ recurrenceForm().get('repeat_interval')?.value || 1 }} day(s)</p>
        </div>
      }
    </div>

    <!-- Section 3: End Condition -->
    <div>
      <label class="block text-neutral-950 mb-2">End Condition</label>

      <div class="flex flex-col gap-2 mb-4">
        @for (option of endTypeOptions; track option.value) {
          <label class="flex items-center gap-2 cursor-pointer" [attr.data-testid]="'recurrence-end-' + option.value">
            <lfx-radio-button [form]="recurrenceForm()" control="endTypeUI" [value]="option.value" name="endTypeUI"> </lfx-radio-button>
            <span class="text-sm text-gray-600">{{ option.label }}</span>
          </label>
        }
      </div>

      <!-- End Date Option -->
      @if (endType() === 'date') {
        <div class="pl-6">
          <lfx-calendar
            [form]="recurrenceForm()"
            control="end_date_time"
            placeholder="Select end date"
            [showIcon]="true"
            [minDate]="minEndDate()"
            styleClass="max-w-xs"
            data-testid="recurrence-end-date">
          </lfx-calendar>
        </div>
      }

      <!-- End Occurrences Option -->
      @if (endType() === 'occurrences') {
        <div class="flex items-center gap-2 flex-wrap pl-6">
          <span class="text-sm text-gray-600">After</span>
          <lfx-input-text
            [form]="recurrenceForm()"
            control="end_times"
            type="number"
            placeholder="10"
            styleClass="w-20"
            data-testid="recurrence-end-occurrences">
          </lfx-input-text>
          <span class="text-sm text-gray-600">occurrence(s)</span>
        </div>
      }
    </div>
  </div>
</div>
