<!-- Copyright The Linux Foundation and each contributor to LFX. -->
<!-- SPDX-License-Identifier: MIT -->

<div class="pb-4" data-testid="meeting-registrants-container">
  <!-- Confirm Dialog for registrant deletion -->
  <p-confirmDialog></p-confirmDialog>

  <!-- Step Title -->
  <div class="mb-6">
    <h2 class="font-normal">Invite Guests</h2>
    <p class="text-sm text-gray-500 mt-1">Include key stakeholders and contributors who should participate in this discussion</p>
  </div>

  <!-- Two Column Layout -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <!-- Left Column - Add People -->
    <div class="flex flex-col gap-6">
      <h4 class="text-neutral-950">Add People</h4>

      <!-- Search People / Add Guest Form (always visible) -->
      <div class="border border-gray-200 rounded-lg p-4">
        <lfx-registrant-form [form]="addRegistrantForm" [registrant]="null"> </lfx-registrant-form>

        <div class="flex items-center justify-end gap-3 mt-4">
          <lfx-button
            size="small"
            label="Add Guest"
            severity="info"
            [disabled]="!addRegistrantForm.valid || !addRegistrantForm.dirty"
            (click)="onAddRegistrant()"
            data-testid="add-guest-button">
          </lfx-button>
        </div>
      </div>

      <!-- Committee Selection -->
      <lfx-meeting-committee-manager [selectedCommittees]="form().get('committees')?.value || []" [form]="form()"> </lfx-meeting-committee-manager>

      <!-- Show Meeting Attendees Toggle -->
      <div class="mt-2">
        <lfx-feature-toggle [feature]="showMeetingAttendeesFeature" [form]="form()"></lfx-feature-toggle>
      </div>
    </div>

    <!-- Right Column - Invitation List -->
    <div class="flex flex-col gap-4">
      <!-- Stats header -->
      @if (form().get('committees')?.value?.length > 0) {
        <h4 class="text-neutral-950">
          Additional Guests
          <span class="text-sm text-gray-500" data-testid="stats"> ({{ registrantCount() }}) </span>
        </h4>
      } @else {
        <h4 class="text-neutral-950">Invitation List ({{ registrantCount() }})</h4>
      }

      <!-- Search and filters -->
      <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg" [formGroup]="searchForm">
        <div class="flex-1">
          <lfx-input-text
            size="small"
            [form]="searchForm"
            control="search"
            placeholder="Search invited guests..."
            icon="fa-light fa-search"
            styleClass="w-full"
            dataTest="search-input">
          </lfx-input-text>
        </div>
        <lfx-select
          [form]="searchForm"
          control="status"
          [options]="statusOptions"
          placeholder="Filter by status"
          styleClass="w-full"
          data-testid="status-filter">
        </lfx-select>
      </div>

      <!-- Loading state -->
      @if (loading()) {
        <div class="text-center py-8" data-testid="loading-state">
          <i class="fa-light fa-circle-notch fa-spin text-2xl text-blue-600 mb-2"></i>
          <p class="text-sm text-gray-500">Loading guests...</p>
        </div>
      }

      @if (registrants()) {
        <!-- Empty state -->
        @if (!loading() && filteredRegistrants().length === 0) {
          <div class="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center">
            <div class="flex flex-col items-center gap-4">
              <div class="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center">
                <i class="fa-light fa-users w-8 h-8 text-gray-400"></i>
              </div>
              <div>
                @if (registrantCount() === 0) {
                  <p class="mb-2 text-gray-700">No one invited yet</p>
                  <p class="text-sm text-gray-500">Search for people, select a committee, or add manually</p>
                } @else {
                  <p class="mb-2 text-gray-700">No guests found</p>
                  <p class="text-sm text-gray-500">Try adjusting your search terms or filters</p>
                }
              </div>
            </div>
          </div>
        }

        <!-- Registrants list -->
        @if (!loading() && filteredRegistrants().length > 0) {
          <div class="flex flex-col gap-2 border border-gray-200 rounded-lg p-3" data-testid="registrants-list">
            @for (registrant of filteredRegistrants(); track registrant.uid ?? registrant.tempId) {
              <lfx-registrant-card [registrant]="registrant" (onValidSave)="handleRegistrantUpdate($event)" (onDelete)="handleRegistrantDelete($event)">
              </lfx-registrant-card>
            }
          </div>
        }
      }
    </div>
  </div>
</div>
