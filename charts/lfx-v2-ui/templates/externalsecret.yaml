# Copyright The Linux Foundation and each contributor to LFX.
# SPDX-License-Identifier: MIT
{{- if .Values.externalSecrets.enabled }}
{{- $dataFrom := .Values.externalSecrets.dataFrom | required "externalSecrets.dataFrom is required." }}
{{- $targetName := .Values.externalSecrets.target.name | required "externalSecrets.target.name is required." }}
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: {{ include "lfx-v2-ui.externalSecretName" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "lfx-v2-ui.labels" . | nindent 4 }}
  {{- with (include "lfx-v2-ui.externalSecretAnnotations" .) }}
  annotations:
    {{- . | nindent 4 }}
  {{- end }}
spec:
  refreshInterval: {{ .Values.externalSecrets.refreshInterval }}
  secretStoreRef:
    name: {{ include "lfx-v2-ui.secretStoreName" . }}
    kind: SecretStore
  target:
    name: {{ $targetName }}
    creationPolicy: {{ .Values.externalSecrets.target.creationPolicy }}
    {{- if .Values.externalSecrets.target.template }}
    template:
      {{- toYaml .Values.externalSecrets.target.template | nindent 6 }}
    {{- end }}
  dataFrom:
    {{- toYaml $dataFrom | nindent 4 }}
{{- end }}
