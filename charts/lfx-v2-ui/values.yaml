# Copyright The Linux Foundation and each contributor to LFX.
# SPDX-License-Identifier: MIT

replicaCount: 1

image:
  repository: ghcr.io/linuxfoundation/lfx-v2-ui
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# External Secrets Operator configuration
# Manages secrets from external providers (AWS Secrets Manager, HashiCorp Vault, etc.)
# Requires the External Secrets Operator to be installed in the cluster
externalSecrets:
  # Enable ExternalSecrets integration
  # When enabled, a SecretStore and ExternalSecret will be created
  enabled: false

  # Provider configuration (required)
  # Defines which external secret provider to use and how to authenticate
  # Examples:
  #
  # AWS Secrets Manager:
  # provider:
  #   aws:
  #     service: SecretsManager
  #     region: us-east-1
  #     auth:
  #       jwt:
  #         serviceAccountRef:
  #           name: lfx-v2-ui-sa
  provider: {}

  # Annotations to add to ExternalSecret resources
  annotations: {}

  # SecretStore-specific configuration
  secretStore:
    # Annotations specific to the SecretStore resource
    annotations: {}
    # Name of the SecretStore resource
    # Defaults to the fullname template if not specified
    name: ""

  # Name of the ExternalSecret resource
  # Defaults to the fullname template if not specified
  name: ""

  # How frequently the secret should be refreshed from the external provider
  # Format: 10s, 1m, 1h, etc. (default: 10m)
  refreshInterval: "10m"

  # Target Kubernetes Secret configuration
  target:
    # Name of the Secret that will be created/managed (required)
    name: ""

    # Creation policy for the target Secret
    # - Owner: ExternalSecret owns the Secret, deletion of ExternalSecret deletes the Secret
    # - Orphan: Secret won't be deleted when ExternalSecret is deleted
    # - Merge: Merge with existing Secret if it exists
    # - None: Don't create or update the Secret
    creationPolicy: "Owner"

    # Template for generating the Secret content
    # Allows transformation of secret data before creating the Kubernetes Secret
    # Example:
    #   template:
    #     engineVersion: v2
    #     data:
    #       config.json: |
    #         {
    #           "apiKey": "{{ .apiKey }}",
    #           "secretKey": "{{ .secretKey }}"
    #         }
    template: {}

  # Fetch multiple secrets using queries (required)
  # Example:
  #   dataFrom:
  #     - find:
  #         tags:
  #           service: "lfx-v2-ui"
  #       rewrite:
  #         - merge: {}
  dataFrom:
  # Two Auth0 clients are configured for this application, which results in key collisions
  # Extract and prefix both keys to solve this
    - extract:
        key: '/cloudops/managed-secrets/auth0/LFX_ONE'
      rewrite:
        - regexp:
            source: '(.*)'
            replacement: 'auth0_$1'
    - extract:
        key: '/cloudops/managed-secrets/auth0/LFX_ONE_Passwordless'
      rewrite:
        - regexp:
            source: '(.*)'
            replacement: 'auth0_passwordless_$1'
    - find:
        tags:
          service: "pcc"
      rewrite:
        - merge:
            conflictPolicy: Ignore

# Global annotations to add to all resources
annotations: {}

# Global labels to add to all resources
labels: {}

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Automatically mount a ServiceAccount's API credentials?
  automount: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}
podLabels: {}

service:
  type: ClusterIP
  port: 80
  targetPort: 4000
  annotations: {}

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

# Environment variables for the application
# Uses map/object format for deep merging support
environment:
  # Node.js environment
  NODE_ENV:
    value: production
  
  # Application configuration
  PORT:
    value: "4000"
  
  # Cache and temporary directories
  COREPACK_HOME:
    value: "/home/appuser/.cache/node/corepack"
  XDG_CACHE_HOME:
    value: "/home/appuser/.cache"
  TMPDIR:
    value: "/tmp"
  
  # PCC specific configuration
  PCC_BASE_URL:
    value: "https://pcc.k8s.orb.local"
  
  # Auth0 configuration (non-secret values)
  PCC_AUTH0_ISSUER_BASE_URL:
    value: "https://linuxfoundation-dev.auth0.com/"
  PCC_AUTH0_AUDIENCE:
    value: "https://api-gw.dev.platform.linuxfoundation.org/"
  M2M_AUTH_ISSUER_BASE_URL:
    value: "https://linuxfoundation-dev.auth0.com/"
  M2M_AUTH_AUDIENCE:
    value: "https://api-gw.dev.platform.linuxfoundation.org/"

  # Environment identifier
  ENV:
    value: "production"

  # Query service configuration
  QUERY_SERVICE_URL:
    value: "http://query-service.default.svc.cluster.local/query/resources"

  # Optional configuration with defaults
  LOG_LEVEL:
    value: "info"

  # required environment variable secrets

  PCC_AUTH0_CLIENT_ID:
    value:

  PCC_AUTH0_CLIENT_SECRET:
    value:

  PCC_AUTH0_SECRET:
    value:

  SUPABASE_URL:
    value:

  POSTGRES_API_KEY:
    value:

  M2M_AUTH_CLIENT_ID:
    value:

  M2M_AUTH_CLIENT_SECRET:
    value:

  LFX_V2_SERVICE:
    value:

  NATS_URL:
    value:

  AI_PROXY_URL:
    value:

  AI_API_KEY:
    value:

  # Snowflake Analytics Configuration
  # Required for analytics endpoints: active-weeks-streak, pull-requests-merged, code-commits
  SNOWFLAKE_ACCOUNT:
    value:

  SNOWFLAKE_USER:
    value:

  SNOWFLAKE_ROLE:
    value:

  SNOWFLAKE_DATABASE:
    value:

  SNOWFLAKE_WAREHOUSE:
    value:

  SNOWFLAKE_API_KEY:
    value:

  # Optional Snowflake configuration
  SNOWFLAKE_LOG_LEVEL:
    value: "ERROR"

  SNOWFLAKE_LOCK_STRATEGY:
    value: "memory"

  SNOWFLAKE_MIN_CONNECTIONS:
    value: "2"

  SNOWFLAKE_MAX_CONNECTIONS:
    value: "10"
